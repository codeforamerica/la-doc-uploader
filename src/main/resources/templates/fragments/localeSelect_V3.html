<!-- Based on https://www.w3.org/TR/wai-aria-practices/examples/menu-button/menu-button-links.html -->
<div th:fragment="localeSelect_V3" id="translate-button" class="menu-button-links"
     th:with="lang=${#locale.toString()}, currentURL=${#httpServletRequest.requestURI}">
  <button type="button"
          id="menubutton"
          class="button"
          aria-haspopup="true"
          aria-controls="menu2">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <rect width="24" height="24" fill="url(#pattern0)"/>
      <defs>
        <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
          <use xlink:href="#image0_253_3455" transform="translate(-0.373418 -0.367089) scale(0.00230609)"/>
        </pattern>
        <image id="image0_253_3455" width="752" height="752" xlink:href="data:image/png;base64,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"/>
      </defs>
    </svg>
    <span>
      <strong th:text="#{translate_button.button}"></strong>
        <span th:if="${lang.equals('en')}" class="small-text" aria-hidden="true"
              th:text="|#{language-preferences.spanish}, #{language-preferences.vietnamese}|"></span>
        <span th:if="${lang.equals('es')}" class="small-text" aria-hidden="true"
              th:text="|#{language-preferences.english}, #{language-preferences.vietnamese}|"></span>
        <span th:if="${lang.equals('vi')}" class="small-text" aria-hidden="true"
              th:text="|#{language-preferences.english}, #{language-preferences.spanish}|"></span>
    </span>
  </button>
  <ul id="menu2"
      role="menu"
      aria-labelledby="menubutton">
    <li role="none">
      <a th:text="English" th:href="|${currentURL}?lang=en|" class="text--small" role="menuitem"></a>
    </li>
    <li role="none">
      <a th:text="Español" th:href="|${currentURL}?lang=es|" class="text--small" role="menuitem"></a>
    </li>
    <li role="none">
      <a th:text="#{language-preferences.vietnamese}" th:href="|${currentURL}?lang=vi|" class="text--small"
         role="menuitem"></a>
    </li>
  </ul>
</div>
<noscript th:fragment="translate_noscript"
          th:with="lang=${#locale.toString()}, currentURL=${#httpServletRequest.requestURI}">
  <!-- When JavaScript is disabled, hide translate button and show translate links -->
  <style>
    .menu-button-links {
      display: none !important;
    }
  </style>
  <div class="translate-links">
    <a th:if="${!lang.equals('en')}" th:text="English" th:href="|${currentURL}?lang=en|"
       class="toolbar__item toolbar__right-item text--small link--subtle"></a>
    <a th:if="${!lang.equals('es')}" th:text="Español" th:href="|${currentURL}?lang=es|"
       class="toolbar__item toolbar__right-item text--small link--subtle"></a>
    <a th:if="${!lang.equals('vi')}" th:text="#{language-preferences.vietnamese}" th:href="|${currentURL}?lang=vi|"
       class="toolbar__item toolbar__right-item text--small link--subtle"></a>
  </div>
</noscript>

<script th:fragment="translate_button_js">
  /*
 *   This content is licensed according to the W3C Software License at
 *   https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 *   File:   menu-button-links.js
 *
 *   Desc:   Creates a menu button that opens a menu of links
 */

  'use strict';

  class MenuButtonLinks {
    constructor(domNode) {
      this.domNode = domNode;
      this.buttonNode = domNode.querySelector('button');
      this.menuNode = domNode.querySelector('[role="menu"]');
      this.menuitemNodes = [];
      this.firstMenuitem = false;
      this.lastMenuitem = false;
      this.firstChars = [];

      this.buttonNode.addEventListener(
          'keydown',
          this.onButtonKeydown.bind(this)
      );
      this.buttonNode.addEventListener('click', this.onButtonClick.bind(this));

      var nodes = domNode.querySelectorAll('[role="menuitem"]');

      for (var i = 0; i < nodes.length; i++) {
        var menuitem = nodes[i];
        this.menuitemNodes.push(menuitem);
        menuitem.tabIndex = -1;
        this.firstChars.push(menuitem.textContent.trim()[0].toLowerCase());

        menuitem.addEventListener('keydown', this.onMenuitemKeydown.bind(this));

        menuitem.addEventListener(
            'mouseover',
            this.onMenuitemMouseover.bind(this)
        );

        if (!this.firstMenuitem) {
          this.firstMenuitem = menuitem;
        }
        this.lastMenuitem = menuitem;
      }

      domNode.addEventListener('focusin', this.onFocusin.bind(this));
      domNode.addEventListener('focusout', this.onFocusout.bind(this));

      window.addEventListener(
          'mousedown',
          this.onBackgroundMousedown.bind(this),
          true
      );
    }

    setFocusToMenuitem(newMenuitem) {
      this.menuitemNodes.forEach(function (item) {
        if (item === newMenuitem) {
          item.tabIndex = 0;
          newMenuitem.focus();
        } else {
          item.tabIndex = -1;
        }
      });
    }

    setFocusToFirstMenuitem() {
      this.setFocusToMenuitem(this.firstMenuitem);
    }

    setFocusToLastMenuitem() {
      this.setFocusToMenuitem(this.lastMenuitem);
    }

    setFocusToPreviousMenuitem(currentMenuitem) {
      var newMenuitem, index;

      if (currentMenuitem === this.firstMenuitem) {
        newMenuitem = this.lastMenuitem;
      } else {
        index = this.menuitemNodes.indexOf(currentMenuitem);
        newMenuitem = this.menuitemNodes[index - 1];
      }

      this.setFocusToMenuitem(newMenuitem);

      return newMenuitem;
    }

    setFocusToNextMenuitem(currentMenuitem) {
      var newMenuitem, index;

      if (currentMenuitem === this.lastMenuitem) {
        newMenuitem = this.firstMenuitem;
      } else {
        index = this.menuitemNodes.indexOf(currentMenuitem);
        newMenuitem = this.menuitemNodes[index + 1];
      }
      this.setFocusToMenuitem(newMenuitem);

      return newMenuitem;
    }

    setFocusByFirstCharacter(currentMenuitem, char) {
      var start, index;

      if (char.length > 1) {
        return;
      }

      char = char.toLowerCase();

      // Get start index for search based on position of currentItem
      start = this.menuitemNodes.indexOf(currentMenuitem) + 1;
      if (start >= this.menuitemNodes.length) {
        start = 0;
      }

      // Check remaining slots in the menu
      index = this.firstChars.indexOf(char, start);

      // If not found in remaining slots, check from beginning
      if (index === -1) {
        index = this.firstChars.indexOf(char, 0);
      }

      // If match was found...
      if (index > -1) {
        this.setFocusToMenuitem(this.menuitemNodes[index]);
      }
    }

    // Utilities

    getIndexFirstChars(startIndex, char) {
      for (var i = startIndex; i < this.firstChars.length; i++) {
        if (char === this.firstChars[i]) {
          return i;
        }
      }
      return -1;
    }

    // Popup menu methods

    openPopup() {
      this.menuNode.style.display = 'block';
      this.buttonNode.setAttribute('aria-expanded', 'true');
    }

    closePopup() {
      if (this.isOpen()) {
        this.buttonNode.removeAttribute('aria-expanded');
        this.menuNode.style.display = 'none';
      }
    }

    isOpen() {
      return this.buttonNode.getAttribute('aria-expanded') === 'true';
    }

    // Menu event handlers

    onFocusin() {
      this.domNode.classList.add('focus');
    }

    onFocusout() {
      this.domNode.classList.remove('focus');
    }

    onButtonKeydown(event) {
      var key = event.key,
          flag = false;

      switch (key) {
        case ' ':
        case 'Enter':
        case 'ArrowDown':
        case 'Down':
          this.openPopup();
          this.setFocusToFirstMenuitem();
          flag = true;
          break;

        case 'Esc':
        case 'Escape':
          this.closePopup();
          this.buttonNode.focus();
          flag = true;
          break;

        case 'Up':
        case 'ArrowUp':
          this.openPopup();
          this.setFocusToLastMenuitem();
          flag = true;
          break;

        default:
          break;
      }

      if (flag) {
        event.stopPropagation();
        event.preventDefault();
      }
    }

    onButtonClick(event) {
      if (this.isOpen()) {
        this.closePopup();
        this.buttonNode.focus();
      } else {
        this.openPopup();
        this.setFocusToFirstMenuitem();
      }

      event.stopPropagation();
      event.preventDefault();
    }

    onMenuitemKeydown(event) {
      var tgt = event.currentTarget,
          key = event.key,
          flag = false;

      function isPrintableCharacter(str) {
        return str.length === 1 && str.match(/\S/);
      }

      if (event.ctrlKey || event.altKey || event.metaKey) {
        return;
      }

      if (event.shiftKey) {
        if (isPrintableCharacter(key)) {
          this.setFocusByFirstCharacter(tgt, key);
          flag = true;
        }

        if (event.key === 'Tab') {
          this.buttonNode.focus();
          this.closePopup();
          flag = true;
        }
      } else {
        switch (key) {
          case ' ':
            window.location.href = tgt.href;
            break;

          case 'Esc':
          case 'Escape':
            this.closePopup();
            this.buttonNode.focus();
            flag = true;
            break;

          case 'Up':
          case 'ArrowUp':
            this.setFocusToPreviousMenuitem(tgt);
            flag = true;
            break;

          case 'ArrowDown':
          case 'Down':
            this.setFocusToNextMenuitem(tgt);
            flag = true;
            break;

          case 'Home':
          case 'PageUp':
            this.setFocusToFirstMenuitem();
            flag = true;
            break;

          case 'End':
          case 'PageDown':
            this.setFocusToLastMenuitem();
            flag = true;
            break;

          case 'Tab':
            this.closePopup();
            break;

          default:
            if (isPrintableCharacter(key)) {
              this.setFocusByFirstCharacter(tgt, key);
              flag = true;
            }
            break;
        }
      }

      if (flag) {
        event.stopPropagation();
        event.preventDefault();
      }
    }

    onMenuitemMouseover(event) {
      var tgt = event.currentTarget;
      tgt.focus();
    }

    onBackgroundMousedown(event) {
      if (!this.domNode.contains(event.target)) {
        if (this.isOpen()) {
          this.closePopup();
          this.buttonNode.focus();
        }
      }
    }
  }

  // Initialize menu buttons

  window.addEventListener('load', function () {
    var menuButtons = document.querySelectorAll('.menu-button-links');
    for (let i = 0; i < menuButtons.length; i++) {
      new MenuButtonLinks(menuButtons[i]);
    }
  });

</script>